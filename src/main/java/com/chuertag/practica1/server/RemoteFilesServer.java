package com.chuertag.practica1.server;import com.chuertag.practica1.RemoteFiles;import com.chuertag.practica1.RemoteFilesProperties;import java.io.DataInputStream;import java.io.File;import java.io.IOException;import java.io.ObjectOutputStream;import java.net.ServerSocket;import java.net.Socket;import javax.swing.JFrame;import javax.swing.JPanel;import javax.swing.JProgressBar;import javax.swing.tree.DefaultMutableTreeNode;/** * * @author chuertag */public class RemoteFilesServer {    private static ServerSocket ss = null;    private static Socket connection = null;    private static JProgressBar jpb = null;    private static JFrame jfr = null;    public static void main(String[] args) {        if ((System.getProperty("os.name")).contains("Windows")) {            RemoteFilesProperties.windows();        }        try {            ss = new ServerSocket(RemoteFilesProperties.PORT + 1);            System.out.println("Initizalizing server\n");            String path = System.getProperty("user.dir")                    + RemoteFilesProperties.SLASH                    + RemoteFilesProperties.SERVER_DIRECTORY                    + RemoteFilesProperties.SLASH;            File dir = new File(RemoteFilesProperties.SERVER_DIRECTORY);            ss.setReuseAddress(true);            dir.mkdirs();            dir.setWritable(true);            RemoteFiles.setJProgressBar(jpb, "Sending/Receiving file(s)");            jfr = new JFrame("RemoteFilesServer");            jfr.setDefaultCloseOperation(JFrame.DISPOSE_ON_CLOSE);            jfr.setSize(180, 240);            jfr.add(new JPanel().add(jpb));            for (;;) {                connection = ss.accept();                sendFilesInfo();                server(path);                jfr.dispose();            }        } catch (IOException e) {            System.out.println("An exception was thrown, server down: "                    + e.getMessage());        }    }    private static void server(String path) throws IOException {        connection = ss.accept();        DataInputStream dis = new DataInputStream(connection.getInputStream());        boolean action = dis.readBoolean();        jfr.setVisible(true);        if (action) {            RemoteFiles.receiveFiles("", System.getProperty("user.dir")                    + RemoteFilesProperties.SLASH                    + RemoteFilesProperties.SERVER_DIRECTORY                    + RemoteFilesProperties.SLASH, true, jpb, "",                    RemoteFilesProperties.PORT);        } else {            File file = new File(path + dis.readUTF());            if (file.exists()) {                if (file.isDirectory()) {                    RemoteFiles.sendFiles(file.listFiles(), jpb, true, "", true, "", RemoteFilesProperties.PORT);                } else {                    RemoteFiles.sendFiles(new File[]{file}, jpb, false, "", true, "", RemoteFilesProperties.PORT);                }            }        }    }    private static void sendFilesInfo() throws IOException {        File cFile = new File(System.getProperty("user.dir")                + RemoteFilesProperties.SLASH                + RemoteFilesProperties.SERVER_DIRECTORY);        ObjectOutputStream oos = new ObjectOutputStream(                connection.getOutputStream());        DefaultMutableTreeNode top = new DefaultMutableTreeNode("MyFiles");        filesInfo(top, cFile.listFiles());        oos.writeObject(top);        oos.flush();        oos.close();        connection.close();    }    private static void filesInfo(DefaultMutableTreeNode top, File[] files) {        String filename;        for (File file : files) {            if (file.isDirectory()) {                filename = file.getName();                DefaultMutableTreeNode node = new DefaultMutableTreeNode(                        new File(filename));                top.add(node);                filesInfo(node, file.listFiles());            } else {                filename = file.getName();                DefaultMutableTreeNode node = new DefaultMutableTreeNode(                        new File(filename));                top.add(node);            }        }    }}